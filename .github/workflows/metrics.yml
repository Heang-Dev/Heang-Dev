name: Metrics
on:
  # Schedule updates (weekly on Sunday at midnight)
  schedule:
    - cron: "0 0 * * 0"
  # Run on push to main branch
  push:
    branches:
      - main
  # Allow manual trigger
  workflow_dispatch:

permissions:
  contents: write

jobs:
  # =====================================================
  # MAIN METRICS - Header, Stats, Languages, Achievements
  # =====================================================
  github-metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Main Metrics
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: Heang-Dev
          template: classic
          base: header, activity, community, repositories, metadata
          base_indepth: yes
          config_timezone: Asia/Phnom_Penh

          # Languages Plugin
          plugin_languages: yes
          plugin_languages_limit: 8
          plugin_languages_threshold: 0%
          plugin_languages_other: yes
          plugin_languages_sections: most-used
          plugin_languages_indepth: yes
          plugin_languages_recent_load: 300
          plugin_languages_recent_days: 14

          # Achievements Plugin
          plugin_achievements: yes
          plugin_achievements_threshold: C
          plugin_achievements_display: detailed
          plugin_achievements_secrets: yes

          # Notable Contributions
          plugin_notable: yes
          plugin_notable_from: all
          plugin_notable_repositories: yes
          plugin_notable_indepth: yes

          # Output
          filename: metrics.svg
          output_action: commit
          committer_token: ${{ secrets.GITHUB_TOKEN }}
          committer_branch: main
          committer_message: "chore: update main metrics"

  # =====================================================
  # CONTRIBUTION CALENDAR - Isometric 3D Calendar
  # =====================================================
  isocalendar:
    runs-on: ubuntu-latest
    steps:
      - name: Isometric Calendar
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: Heang-Dev
          template: classic
          base: ""
          config_timezone: Asia/Phnom_Penh

          # Isometric Calendar Plugin
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year

          # Output
          filename: isocalendar.svg
          output_action: commit
          committer_token: ${{ secrets.GITHUB_TOKEN }}
          committer_branch: main
          committer_message: "chore: update isocalendar"

  # =====================================================
  # HABITS - Coding Habits and Charts
  # =====================================================
  habits:
    runs-on: ubuntu-latest
    steps:
      - name: Coding Habits
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: Heang-Dev
          template: classic
          base: ""
          config_timezone: Asia/Phnom_Penh

          # Habits Plugin
          plugin_habits: yes
          plugin_habits_from: 200
          plugin_habits_days: 14
          plugin_habits_facts: yes
          plugin_habits_charts: yes
          plugin_habits_charts_type: classic
          plugin_habits_trim: yes
          plugin_habits_languages_limit: 8
          plugin_habits_languages_threshold: 0%

          # Output
          filename: habits.svg
          output_action: commit
          committer_token: ${{ secrets.GITHUB_TOKEN }}
          committer_branch: main
          committer_message: "chore: update habits"

  # =====================================================
  # ACTIVITY - Recent GitHub Activity
  # =====================================================
  activity:
    runs-on: ubuntu-latest
    steps:
      - name: Recent Activity
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: Heang-Dev
          template: classic
          base: ""
          config_timezone: Asia/Phnom_Penh

          # Activity Plugin
          plugin_activity: yes
          plugin_activity_limit: 5
          plugin_activity_load: 300
          plugin_activity_days: 14
          plugin_activity_visibility: public
          plugin_activity_timestamps: yes
          plugin_activity_filter: all

          # Output
          filename: activity.svg
          output_action: commit
          committer_token: ${{ secrets.GITHUB_TOKEN }}
          committer_branch: main
          committer_message: "chore: update activity"

  # =====================================================
  # STARGAZERS - Star Growth Chart
  # =====================================================
  stargazers:
    runs-on: ubuntu-latest
    steps:
      - name: Stargazers Chart
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: Heang-Dev
          template: classic
          base: ""

          # Stargazers Plugin
          plugin_stargazers: yes
          plugin_stargazers_days: 365
          plugin_stargazers_charts: yes
          plugin_stargazers_charts_type: graph

          # Output
          filename: stargazers.svg
          output_action: commit
          committer_token: ${{ secrets.GITHUB_TOKEN }}
          committer_branch: main
          committer_message: "chore: update stargazers"

  # =====================================================
  # REPOSITORIES - Featured Repositories
  # =====================================================
  repositories:
    runs-on: ubuntu-latest
    steps:
      - name: Featured Repositories
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: Heang-Dev
          template: classic
          base: ""

          # Repositories Plugin
          plugin_repositories: yes
          plugin_repositories_pinned: 6
          plugin_repositories_starred: 0
          plugin_repositories_forks: yes
          plugin_repositories_affiliations: owner

          # Output
          filename: repositories.svg
          output_action: commit
          committer_token: ${{ secrets.GITHUB_TOKEN }}
          committer_branch: main
          committer_message: "chore: update repositories"

  # =====================================================
  # LINES OF CODE - Code Changes
  # =====================================================
  lines:
    runs-on: ubuntu-latest
    steps:
      - name: Lines of Code
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: Heang-Dev
          template: classic
          base: repositories

          # Lines Plugin
          plugin_lines: yes
          plugin_lines_sections: base, repositories
          plugin_lines_repositories_limit: 4
          plugin_lines_history_limit: 1

          # Output
          filename: lines.svg
          output_action: commit
          committer_token: ${{ secrets.GITHUB_TOKEN }}
          committer_branch: main
          committer_message: "chore: update lines"

  # =====================================================
  # CALENDAR - Contribution Calendar
  # =====================================================
  calendar:
    runs-on: ubuntu-latest
    steps:
      - name: Contribution Calendar
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          user: Heang-Dev
          template: classic
          base: ""
          config_timezone: Asia/Phnom_Penh

          # Calendar Plugin
          plugin_calendar: yes
          plugin_calendar_limit: 2

          # Output
          filename: calendar.svg
          output_action: commit
          committer_token: ${{ secrets.GITHUB_TOKEN }}
          committer_branch: main
          committer_message: "chore: update calendar"
